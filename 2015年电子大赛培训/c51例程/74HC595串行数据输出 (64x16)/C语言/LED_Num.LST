C51 COMPILER V9.01   LED_NUM                                                               02/19/2014 23:43:35 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LED_NUM
OBJECT MODULE PLACED IN LED_Num.OBJ
COMPILER INVOKED BY: D:\keil\keil4\C51\BIN\C51.EXE LED_Num.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*****************************************************************************************
   2          *          ≤…”√4Ω∆¨74HC595 µœ÷LE16*16Dµ„’Ûµƒ∂ØÃ¨…®√Ëœ‘ æ£®π≤—Ùº´LdE1818µ„’Û)              
   3          *                                             π”√TYD-51-1∞Â                                                  *
   4          *  ¡¨Ω”∑Ω∑®£∫                                                                            *
   5          *            sbit SDAT = P1^0;  //¥Æ–– ˝æ› ‰≥ˆ£¨∂®“Â‘⁄P1.0…œ                             *
   6          *            sbit SCLK = P1^1;  //¥Æ––“∆Œª ±÷” ‰≥ˆ£¨∂®“Â‘⁄P1.1…œ                         *
   7          *            sbit LOAD = P1^2;  //74HC595À¯¥Ê¬ˆ≥Â ‰≥ˆ£¨∂®“Â‘⁄P1.2…œ                      *
   8          ******************************************************************************************/
   9          #include <reg52.h> 
  10          #include <intrins.h>
  11          
  12          sbit SDAT = P1^0;  //¥Æ–– ˝æ› ‰≥ˆ£¨∂®“Â‘⁄P1.4…œ
  13          sbit SCLK = P1^1;  //¥Æ––“∆Œª ±÷” ‰≥ˆ£¨∂®“Â‘⁄P1.5…œ
  14          sbit LOAD = P1^2;  //74HC595À¯¥Ê¬ˆ≥Â ‰≥ˆ£¨∂®“Â‘⁄P1.6…œ
  15          
  16          #define COUNT 2500
  17          unsigned int code lie_tab[]={0x0001,0x0002,0x0004,0x0008,
  18                                       0x0010,0x0020,0x0040,0x0080,
  19                                       0x0100,0x0200,0x0400,0x0800,
  20                                                                   0x1000,0x2000,0x4000,0x8000
  21          };
  22          
  23          unsigned char code tab[]={0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};
  24          
  25          unsigned char code   Disp_Tab[] = {0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x40};  //∂Œ¬Îøÿ÷∆
  26          
  27          unsigned char code digittab[19][8]={
  28          
  29          {0x00,0x00,0x3e,0x41,0x41,0x41,0x3e,0x00}, //0
  30          {0x00,0x00,0x00,0x21,0x7f,0x01,0x00,0x00}, //1
  31          {0x00,0x00,0x21,0x43,0x45,0x49,0x31,0x00}, //2
  32          {0x00,0x00,0x22,0x49,0x49,0x49,0x36,0x00}, //3
  33          {0x00,0x00,0x0c,0x14,0x24,0x7f,0x04,0x00}, //4
  34          {0x00,0x00,0x72,0x51,0x51,0x51,0x4e,0x00}, //5
  35          {0x00,0x00,0x3e,0x49,0x49,0x49,0x26,0x00}, //6
  36          {0x00,0x00,0x40,0x40,0x4f,0x50,0x60,0x00}, //7
  37          {0x00,0x00,0x36,0x49,0x49,0x49,0x36,0x00}, //8
  38          {0x00,0x00,0x32,0x49,0x49,0x49,0x3e,0x00}, //9
  39          
  40          {0x00,0x00,0x40,0x40,0x7F,0x40,0x40,0x00}, //T
  41          {0x00,0x00,0x40,0x20,0x1F,0x20,0x40,0x00}, //Y
  42          {0x00,0x00,0x41,0x7f,0x41,0x41,0x3E,0x00}, //D
  43          {0x00,0x00,0x18,0x18,0x18,0x18,0x18,0x00}, //-
  44          {0x00,0x00,0x72,0x51,0x51,0x51,0x4e,0x00}, //5
  45          {0x00,0x00,0x00,0x21,0x7f,0x01,0x00,0x00}, //1
  46          {0x00,0x00,0x18,0x18,0x18,0x18,0x18,0x00}, //-
  47          {0x00,0x00,0x22,0x49,0x49,0x49,0x36,0x00}, //3
  48          {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //ø’
  49          };
  50          
  51          unsigned long x=0;
  52          
  53          int hz=0,time=50000;
  54          
  55          unsigned char code hz_dot[]={
C51 COMPILER V9.01   LED_NUM                                                               02/19/2014 23:43:35 PAGE 2   

  56          
  57          /*--  Œƒ◊÷:  ∑Æ  --*/
  58          /*--  ÀŒÃÂ12;  ¥À◊÷ÃÂœ¬∂‘”¶µƒµ„’ÛŒ™£∫øÌx∏ﬂ=16x16   --*/
  59          0x24,0x48,0x22,0x88,0xF9,0x3E,0x22,0x88,0x64,0x58,0x72,0x9C,0xA9,0x2A,0x22,0x88,
  60          0x25,0x48,0x01,0x00,0xFF,0xFE,0x02,0x80,0x04,0x40,0x08,0x20,0x30,0x18,0xC0,0x06, 0x00,0x00,0x00,0x00,
  61          
  62          /*--  Œƒ◊÷:  ◊‹  --*/
  63          /*--  ÀŒÃÂ12;  ¥À◊÷ÃÂœ¬∂‘”¶µƒµ„’ÛŒ™£∫øÌx∏ﬂ=16x16   --*/
  64          0x10,0x10,0x08,0x20,0x04,0x40,0x00,0x00,0x1F,0xF0,0x10,0x10,0x10,0x10,0x10,0x10,
  65          0x1F,0xF0,0x10,0x10,0x01,0x00,0x08,0x84,0x48,0x92,0x48,0x12,0x87,0xF0,0x00,0x00, 0x00,0x00,0x00,0x00,
  66          
  67          /*--  Œƒ◊÷:  ƒ„  --*/
  68          /*--  ÀŒÃÂ12;  ¥À◊÷ÃÂœ¬∂‘”¶µƒµ„’ÛŒ™£∫øÌx∏ﬂ=16x16   --*/
  69          0x08,0x80,0x08,0x80,0x08,0x80,0x11,0xFE,0x11,0x02,0x32,0x04,0x34,0x20,0x50,0x20,
  70          0x91,0x28,0x11,0x24,0x12,0x24,0x12,0x22,0x14,0x22,0x10,0x20,0x10,0xA0,0x10,0x40,  0x00,0x00,0x00,0x00,
  71          
  72          /*--  Œƒ◊÷:   «  --*/
  73          /*--  ÀŒÃÂ12;  ¥À◊÷ÃÂœ¬∂‘”¶µƒµ„’ÛŒ™£∫øÌx∏ﬂ=16x16   --*/
  74          0x1F,0xF0,0x10,0x10,0x10,0x10,0x1F,0xF0,0x10,0x10,0x10,0x10,0x1F,0xF0,0x00,0x00,
  75          0xFF,0xFE,0x01,0x00,0x11,0x00,0x11,0xF8,0x11,0x00,0x29,0x00,0x45,0x00,0x83,0xFE,0x00,0x00,0x00,0x00,
  76          
  77          /*--  Œƒ◊÷:  ”–  --*/
  78          /*--  ÀŒÃÂ12;  ¥À◊÷ÃÂœ¬∂‘”¶µƒµ„’ÛŒ™£∫øÌx∏ﬂ=16x16   --*/
  79          0x02,0x00,0x02,0x00,0xFF,0xFE,0x04,0x00,0x04,0x00,0x0F,0xF0,0x08,0x10,0x18,0x10,
  80          0x2F,0xF0,0x48,0x10,0x88,0x10,0x0F,0xF0,0x08,0x10,0x08,0x10,0x08,0x50,0x08,0x20,0x00,0x00,0x00,0x00,
  81          
  82          /*--  Œƒ◊÷:  ∂‡  --*/
  83          /*--  ÀŒÃÂ12;  ¥À◊÷ÃÂœ¬∂‘”¶µƒµ„’ÛŒ™£∫øÌx∏ﬂ=16x16   --*/
  84          0x02,0x00,0x02,0x00,0x07,0xF0,0x08,0x20,0x38,0x40,0x04,0x80,0x03,0x40,0x0C,0x80,
  85          0x71,0xF8,0x02,0x08,0x0C,0x10,0x32,0x20,0x01,0x40,0x01,0x80,0x0E,0x00,0x70,0x00,0x00,0x00,0x00,0x00,
  86          
  87          /*--  Œƒ◊÷:  ª¢  --*/
  88          /*--  ÀŒÃÂ12;  ¥À◊÷ÃÂœ¬∂‘”¶µƒµ„’ÛŒ™£∫øÌx∏ﬂ=16x16   --*/
  89          0x01,0x00,0x01,0xF8,0x01,0x00,0x3F,0xFC,0x21,0x04,0x21,0x60,0x2F,0x88,0x21,0x08,
  90          0x20,0xF8,0x20,0x00,0x23,0xE0,0x22,0x20,0x22,0x20,0x44,0x24,0x48,0x24,0x90,0x1C,0x00,0x00,0x00,0x00,
  91          
  92          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,
  93          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00
  94          
  95          
  96          
  97          
  98          
  99          
 100          };
 101          
 102          
 103          unsigned int timecount;
 104          
 105          unsigned char cnta;
 106          
 107          unsigned char cntb;
 108          
 109          unsigned char disp_count;
 110          
 111          
 112          /**************************************************************************
 113          *
 114          *                      —” ±¥¶¿Ì
 115          *
 116          ****************************************************************************/
 117          void delay(unsigned int i)
C51 COMPILER V9.01   LED_NUM                                                               02/19/2014 23:43:35 PAGE 3   

 118          {
 119   1          char j;
 120   1          for(i; i > 0; i--)
 121   1              for(j = 200; j > 0; j--);
 122   1      }
 123          
 124          //**********************************************************************
 125          
 126          void send_byte(unsigned char dat)
 127          {
 128   1          unsigned long dly;
 129   1          unsigned char i,x;
 130   1              x=dat;
 131   1              for(i=0;i<8;i++)
 132   1              {
 133   2                      if((x & 0x80)!=0)
 134   2                      {
 135   3                              SDAT=1;
 136   3                      }
 137   2                      else
 138   2                      {
 139   3                              SDAT=0;
 140   3                      }
 141   2                      SCLK=1;
 142   2                      dly++;
 143   2                      SCLK=0;
 144   2                      x=x<<1;
 145   2              }
 146   1      }
 147          
 148          
 149          void send_4x595out(unsigned char dat1,unsigned char dat2,unsigned char dat3,unsigned char dat4)
 150          {
 151   1          unsigned long dly;
 152   1              send_byte(dat4);
 153   1              send_byte(dat3);
 154   1              send_byte(dat2);
 155   1              send_byte(dat1);
 156   1          LOAD=0;
 157   1              dly++;
 158   1              LOAD=1;
 159   1      }
 160          //////////////////////////////////
 161          char high_H8=0x80,high_L8=0x80,width_L8=0x00,width_H8=0x01;
 162          char flg=0;
 163          //////////////////////////////////
 164          void demo(void)
 165          {
 166   1              while(1)
 167   1              {
 168   2                      send_4x595out(high_L8^0xff,high_H8^0xff,width_L8^0xff,width_H8^0xff);
 169   2                      delay(time);
 170   2                      high_H8=high_H8>>1;
 171   2                      if((high_H8==0)&&(flg==0))
 172   2                      {
 173   3                              high_L8=0x80;
 174   3                              flg=1;
 175   3                      }
 176   2                      else
 177   2                              high_L8=high_L8>>1;
 178   2                      if((high_L8==0)&&(flg==1))
 179   2                      {
C51 COMPILER V9.01   LED_NUM                                                               02/19/2014 23:43:35 PAGE 4   

 180   3                              high_H8=0x80;
 181   3                              flg=0;
 182   3                      }
 183   2              }                       
 184   1      }
 185          //*************************************************
 186          void main(void)
 187          {
 188   1          char i,j;
 189   1              TMOD=0x01;
 190   1              TH0=(65536-COUNT)/256;
 191   1              TL0=(65536-COUNT)%256;
 192   1              TR0=1;     //ø™∆Ù∂® ±0
 193   1              ET0=1;
 194   1              LOAD=1;
 195   1          SCLK=0;
 196   1              SDAT=0;
 197   1      //      EA=1;      //ø™∆Ù÷–∂œ
 198   1              cntb=0;
 199   1          send_4x595out(0,0,0,0);
 200   1              send_4x595out(0,255,0,255);
 201   1          while(1)
 202   1              {   
 203   2              for(j=0;j<16;j++)
 204   2                      {
 205   3                          send_4x595out((~lie_tab[j]%256),(~lie_tab[j]/256),~hz_dot[j*2+1+hz*2],~hz_dot[j*2+hz*2]);
 206   3                          delay(10);
 207   3                      }
 208   2                      x++;
 209   2                      if(x>2)
 210   2                      {
 211   3                              hz++;
 212   3                              x=0;
 213   3                              if(hz>111)
 214   3                              {
 215   4                                      hz=0;
 216   4                              }
 217   3                      }
 218   2      
 219   2              }//*/    
 220   1      }
*** WARNING C280 IN LINE 188 OF LED_NUM.C: 'i': unreferenced local variable
 221          
 222          /*************************************************
 223          *
 224          *          ∂® ±÷–∂œ
 225          ********************************************************/                                                   
 226          void t0(void) interrupt 1 using 0
 227          {
 228   1              unsigned char x1,x2;
 229   1      
 230   1              TH0=(65536-COUNT)/256;   //∂® ±∆˜∏ﬂŒª◊∞‘ÿ ˝æ›
 231   1              TL0=(65536-COUNT)%256;   //∂® ±∆˜µÕŒª◊∞‘ÿ ˝æ›
 232   1      
 233   1              x1=~tab[cnta];
 234   1              x2=~digittab[cntb][cnta];
 235   1      //      send_2x595out(x2,x1);
 236   1      
 237   1              if(++cnta>=8) cnta=0;
 238   1              if(++timecount>=333)
 239   1              {
 240   2              timecount=0;
C51 COMPILER V9.01   LED_NUM                                                               02/19/2014 23:43:35 PAGE 5   

 241   2              if(++cntb>=19)cntb=0;
 242   2              }
 243   1      }
 244          
 245          
 246          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    583    ----
   CONSTANT SIZE    =    487    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
