C51 COMPILER V9.52.0.0   18B20                                                             06/17/2015 07:50:47 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE 18B20
OBJECT MODULE PLACED IN 18B20.OBJ
COMPILER INVOKED BY: C:\Program Files\keil\C51\BIN\C51.EXE 18B20.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include<reg52.h>
   2          #include"18B20.h"
   3          /*******************************************************************************
   4          * º¯ Êý Ãû         : Delay1ms
   5          * º¯Êý¹¦ÄÜ       : ÑÓÊ±º¯Êý
   6          * Êä    Èë         : ÎÞ
   7          * Êä    ³ö         : ÎÞ
   8          *******************************************************************************/
   9          
  10          void Delay1ms(uint y)
  11          {
  12   1        uint x;
  13   1        for( ; y>0; y--)
  14   1        {
  15   2          for(x=110; x>0; x--);
  16   2        }
  17   1      }
  18          /*******************************************************************************
  19          * º¯ Êý Ãû         : Ds18b20Init
  20          * º¯Êý¹¦ÄÜ       : ³õÊ¼»¯
  21          * Êä    Èë         : ÎÞ
  22          * Êä    ³ö         : ³õÊ¼»¯³É¹¦·µ»Ø1£¬Ê§°Ü·µ»Ø0
  23          *******************************************************************************/
  24          
  25          uchar Ds18b20Init()
  26          {
  27   1        uchar i;
  28   1        DSPORT = 0;      //½«×ÜÏßÀ­µÍ480us~960us
  29   1        i = 70; 
  30   1        while(i--);//ÑÓÊ±642us
  31   1        DSPORT = 1;     //È»ºóÀ­¸ß×ÜÏß£¬Èç¹ûDS18B20×ö³ö·´Ó¦»á½«ÔÚ15us~60usºó×ÜÏßÀ­µÍ
  32   1        i = 0;
  33   1        while(DSPORT) //µÈ´ýDS18B20À­µÍ×ÜÏß
  34   1        {
  35   2          Delay1ms(1);
  36   2          i++;
  37   2          if(i>5)//µÈ´ý>5MS
  38   2          {
  39   3            return 0;//³õÊ¼»¯Ê§°Ü
  40   3          }
  41   2        
  42   2        }
  43   1        return 1;//³õÊ¼»¯³É¹¦
  44   1      }
  45          
  46          /*******************************************************************************
  47          * º¯ Êý Ãû         : Ds18b20WriteByte
  48          * º¯Êý¹¦ÄÜ       : Ïò18B20Ð´ÈëÒ»¸ö×Ö½Ú
  49          * Êä    Èë         : com
  50          * Êä    ³ö         : ÎÞ
  51          *******************************************************************************/
  52          
  53          void Ds18b20WriteByte(uchar dat)
  54          {
  55   1        uint i, j;
C51 COMPILER V9.52.0.0   18B20                                                             06/17/2015 07:50:47 PAGE 2   

  56   1      
  57   1        for(j=0; j<8; j++)
  58   1        {
  59   2          DSPORT = 0;         //Ã¿Ð´ÈëÒ»Î»Êý¾ÝÖ®Ç°ÏÈ°Ñ×ÜÏßÀ­µÍ1us
  60   2          i++;
  61   2          DSPORT = dat & 0x01;  //È»ºóÐ´ÈëÒ»¸öÊý¾Ý£¬´Ó×îµÍÎ»¿ªÊ¼
  62   2          i=6;
  63   2          while(i--); //ÑÓÊ±68us£¬³ÖÐøÊ±¼ä×îÉÙ60us
  64   2          DSPORT = 1; //È»ºóÊÍ·Å×ÜÏß£¬ÖÁÉÙ1us¸ø×ÜÏß»Ö¸´Ê±¼ä²ÅÄÜ½Ó×ÅÐ´ÈëµÚ¶þ¸öÊýÖµ
  65   2          dat >>= 1;
  66   2        }
  67   1      }
  68          /*******************************************************************************
  69          * º¯ Êý Ãû         : Ds18b20ReadByte
  70          * º¯Êý¹¦ÄÜ       : ¶ÁÈ¡Ò»¸ö×Ö½Ú
  71          * Êä    Èë         : com
  72          * Êä    ³ö         : ÎÞ
  73          *******************************************************************************/
  74          
  75          
  76          uchar Ds18b20ReadByte()
  77          {
  78   1        uchar byte, bi;
  79   1        uint i, j;  
  80   1        for(j=8; j>0; j--)
  81   1        {
  82   2          DSPORT = 0;//ÏÈ½«×ÜÏßÀ­µÍ1us
  83   2          i++;
  84   2          DSPORT = 1;//È»ºóÊÍ·Å×ÜÏß
  85   2          i++;
  86   2          i++;//ÑÓÊ±6usµÈ´ýÊý¾ÝÎÈ¶¨
  87   2          bi = DSPORT;   //¶ÁÈ¡Êý¾Ý£¬´Ó×îµÍÎ»¿ªÊ¼¶ÁÈ¡
  88   2          /*½«byte×óÒÆÒ»Î»£¬È»ºóÓëÉÏÓÒÒÆ7Î»ºóµÄbi£¬×¢ÒâÒÆ¶¯Ö®ºóÒÆµôÄÇÎ»²¹0¡£*/
  89   2          byte = (byte >> 1) | (bi << 7);             
  90   2          i = 4;    //¶ÁÈ¡ÍêÖ®ºóµÈ´ý48usÔÙ½Ó×Å¶ÁÈ¡ÏÂÒ»¸öÊý
  91   2          while(i--);
  92   2        }       
  93   1        return byte;
  94   1      }
  95          /*******************************************************************************
  96          * º¯ Êý Ãû         : Ds18b20ChangTemp
  97          * º¯Êý¹¦ÄÜ       : ÈÃ18b20¿ªÊ¼×ª»»ÎÂ¶È
  98          * Êä    Èë         : com
  99          * Êä    ³ö         : ÎÞ
 100          *******************************************************************************/
 101          
 102          void  Ds18b20ChangTemp()
 103          {
 104   1        Ds18b20Init();
 105   1        Delay1ms(1);
 106   1        Ds18b20WriteByte(0xcc);   //Ìø¹ýROM²Ù×÷ÃüÁî    
 107   1        Ds18b20WriteByte(0x44);     //ÎÂ¶È×ª»»ÃüÁî
 108   1      //  Delay1ms(100);  //µÈ´ý×ª»»³É¹¦£¬¶øÈç¹ûÄãÊÇÒ»Ö±Ë¢×ÅµÄ»°£¬¾Í²»ÓÃÕâ¸öÑÓÊ±ÁË
 109   1         
 110   1      }
 111          /*******************************************************************************
 112          * º¯ Êý Ãû         : Ds18b20ReadTempCom
 113          * º¯Êý¹¦ÄÜ       : ·¢ËÍ¶ÁÈ¡ÎÂ¶ÈÃüÁî
 114          * Êä    Èë         : com
 115          * Êä    ³ö         : ÎÞ
 116          *******************************************************************************/
 117          
C51 COMPILER V9.52.0.0   18B20                                                             06/17/2015 07:50:47 PAGE 3   

 118          void  Ds18b20ReadTempCom()
 119          { 
 120   1      
 121   1        Ds18b20Init();
 122   1        Delay1ms(1);
 123   1        Ds18b20WriteByte(0xcc);  //Ìø¹ýROM²Ù×÷ÃüÁî
 124   1        Ds18b20WriteByte(0xbe);  //·¢ËÍ¶ÁÈ¡ÎÂ¶ÈÃüÁî
 125   1      }
 126          /*******************************************************************************
 127          * º¯ Êý Ãû         : Ds18b20ReadTemp
 128          * º¯Êý¹¦ÄÜ       : ¶ÁÈ¡ÎÂ¶È
 129          * Êä    Èë         : com
 130          * Êä    ³ö         : ÎÞ
 131          *******************************************************************************/
 132          
 133          int Ds18b20ReadTemp()
 134          {
 135   1        int temp = 0;
 136   1        uchar tmh, tml;
 137   1        Ds18b20ChangTemp();       //ÏÈÐ´Èë×ª»»ÃüÁî
 138   1        Ds18b20ReadTempCom();     //È»ºóµÈ´ý×ª»»Íêºó·¢ËÍ¶ÁÈ¡ÎÂ¶ÈÃüÁî
 139   1        tml = Ds18b20ReadByte();    //¶ÁÈ¡ÎÂ¶ÈÖµ¹²16Î»£¬ÏÈ¶ÁµÍ×Ö½Ú
 140   1        tmh = Ds18b20ReadByte();    //ÔÙ¶Á¸ß×Ö½Ú
 141   1        temp = tmh;
 142   1        temp <<= 8;
 143   1        temp |= tml;
 144   1        return temp;
 145   1      }
 146          
 147          
 148          /*void LcdDisplayTemp(int temp)    //lcdÏÔÊ¾
 149          {
 150            unsigned char i; 
 151            unsigned char code  p2[]= "TEMP:";
 152              float tp;  
 153            if(temp< 0)       //µ±ÎÂ¶ÈÖµÎª¸ºÊý
 154              {
 155              DisplayData[0] = 0x40; 
 156              //ÒòÎª¶ÁÈ¡µÄÎÂ¶ÈÊÇÊµ¼ÊÎÂ¶ÈµÄ²¹Âë£¬ËùÒÔ¼õ1£¬ÔÙÈ¡·´Çó³öÔ­Âë
 157              temp=temp-1;
 158              temp=~temp;
 159              tp=temp;
 160              temp=tp*0.0625*100+0.5; 
 161              //ÁôÁ½¸öÐ¡Êýµã¾Í*100£¬+0.5ÊÇËÄÉáÎåÈë£¬ÒòÎªCÓïÑÔ¸¡µãÊý×ª»»ÎªÕûÐÍµÄÊ±ºò°ÑÐ¡Êýµã
 162              //ºóÃæµÄÊý×Ô¶¯È¥µô£¬²»¹ÜÊÇ·ñ´óÓÚ0.5£¬¶ø+0.5Ö®ºó´óÓÚ0.5µÄ¾ÍÊÇ½ø1ÁË£¬Ð¡ÓÚ0.5µÄ¾Í
 163              //ËãÓÉÏ0.5£¬»¹ÊÇÔÚÐ¡ÊýµãºóÃæ¡£
 164           
 165              }
 166            else
 167              {     
 168              DisplayData[0] = 0x00;
 169              tp=temp;//ÒòÎªÊý¾Ý´¦ÀíÓÐÐ¡ÊýµãËùÒÔ½«ÎÂ¶È¸³¸øÒ»¸ö¸¡µãÐÍ±äÁ¿
 170              //Èç¹ûÎÂ¶ÈÊÇÕýµÄÄÇÃ´£¬ÄÇÃ´ÕýÊýµÄÔ­Âë¾ÍÊÇ²¹ÂëËü±¾Éí
 171              temp=tp*0.0625*100+0.5; 
 172              //ÁôÁ½¸öÐ¡Êýµã¾Í*100£¬+0.5ÊÇËÄÉáÎåÈë£¬ÒòÎªCÓïÑÔ¸¡µãÊý×ª»»ÎªÕûÐÍµÄÊ±ºò°ÑÐ¡Êýµã
 173              //ºóÃæµÄÊý×Ô¶¯È¥µô£¬²»¹ÜÊÇ·ñ´óÓÚ0.5£¬¶ø+0.5Ö®ºó´óÓÚ0.5µÄ¾ÍÊÇ½ø1ÁË£¬Ð¡ÓÚ0.5µÄ¾Í
 174              //Ëã¼ÓÉÏ0.5£¬»¹ÊÇÔÚÐ¡ÊýµãºóÃæ¡£
 175            }
 176            //P3=tp;
 177          
 178            Data0[0] = temp / 10000;
 179            Data0[1] = temp % 10000 / 1000;
C51 COMPILER V9.52.0.0   18B20                                                             06/17/2015 07:50:47 PAGE 4   

 180            Data0[2] = temp % 1000 / 100 ;
 181            Data0[3] = temp % 100 / 10;
 182            Data0[4] = temp % 10;
 183            
 184            for(i=0;i<=4;i++)
 185            {
 186              switch(Seg_Data[Data0[i]])
 187              {
 188                case 0xc0:
 189                {T[i]=0x30;break;}
 190                case 0xF9:
 191                {T[i]=0x31;break;}
 192                case 0xA4:
 193                {T[i]=0x32;break;}
 194                case 0xB0:
 195                {T[i]=0x33;break;}
 196                case 0x99:
 197                {T[i]=0x34;break;}
 198                case 0x92:
 199                { T[i]=0x35;break;}
 200                case 0x82:
 201                { T[i]=0x30;break;}
 202                case 0xF8:
 203                {T[i]=0x36;break;}
 204                case 0x80:
 205                {T[i]=0x37;break;}
 206                case 0x90:
 207                {T[i]=0x38;break;}      
 208              }
 209            }
 210                 LCD1602_WriteInformation(0x01,0);  //ÇåÆÁÖ¸Áî
 211            LCD1602_MoveToPosition(0,0);
 212                     LCD1602_DisplayString(p2);
 213                 LCD1602_DisplayOneCharOnAddr(0,6,T[1]);
 214                LCD1602_DisplayOneCharOnAddr(0,7,T[2]);
 215                LCD1602_DisplayOneCharOnAddr(0,8,0x2e);//.
 216                LCD1602_DisplayOneCharOnAddr(0,9,T[3]);
 217                 LCD1602_DisplayOneCharOnAddr(0,10,0x06); //¡ãc
 218          }*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    234    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
