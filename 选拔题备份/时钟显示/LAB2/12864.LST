C51 COMPILER V9.52.0.0   12864                                                             05/29/2015 18:43:27 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE 12864
OBJECT MODULE PLACED IN 12864.OBJ
COMPILER INVOKED BY: C:\Program Files\keil\C51\BIN\C51.EXE 12864.c LARGE BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include<reg52.h>
   2          #include"12864.h"
   3          
   4          /*******************************************************************/
   5          /*                                                                 */
   6          /*  延时函数                                                       */
   7          /*                                                                 */
   8          /*******************************************************************/
   9          void delay_12864(int ms)
  10          {
  11   1          while(ms--)
  12   1        {
  13   2            uchar i;
  14   2          for(i=0;i<150;i++)  
  15   2           {
  16   3            _nop_();         
  17   3          _nop_();
  18   3          _nop_();
  19   3          _nop_();
  20   3           }
  21   2        }
  22   1      } 
  23          /*******************************************************************/
  24          /*                                                                 */
  25          /*  延时函数                                                       */
  26          /*                                                                 */
  27          /*******************************************************************/
  28          void delay1_12864(int ms)
  29          {
  30   1          while(ms--)
  31   1        {
  32   2            uchar y;
  33   2          for(y=0;y<100;y++) ; 
  34   2        }
  35   1      }     
  36          /*******************************************************************/
  37          /*                                                                 */
  38          /*检查LCD忙状态                                                    */
  39          /*lcd_busy为1时，忙，等待。lcd-busy为0时,闲，可写指令与数据。      */
  40          /*                                                                 */
  41          /*******************************************************************/
  42          bit lcd_busy()
  43           {                          
  44   1          bit result;
  45   1          LCD_RS = 0;
  46   1          LCD_RW = 1;
  47   1          LCD_EN = 1;
  48   1          delayNOP();
  49   1          result = (bit)(P0&0x80);
  50   1          LCD_EN = 0;
  51   1          return(result); 
  52   1       }
  53          /*******************************************************************/
  54          /*                                                                 */
  55          /*写指令数据到LCD                                                  */
C51 COMPILER V9.52.0.0   12864                                                             05/29/2015 18:43:27 PAGE 2   

  56          /*RS=L，RW=L，E=高脉冲，D0-D7=指令码。                             */
  57          /*                                                                 */
  58          /*******************************************************************/
  59          void lcd_wcmd(uchar cmd)
  60          {                          
  61   1         while(lcd_busy());
  62   1          LCD_RS = 0;
  63   1          LCD_RW = 0;
  64   1          LCD_EN = 0;
  65   1          _nop_();
  66   1          _nop_(); 
  67   1          P0 = cmd;
  68   1          delayNOP();
  69   1          LCD_EN = 1;
  70   1          delayNOP();
  71   1          LCD_EN = 0;  
  72   1      }
  73          /*******************************************************************/
  74          /*                                                                 */
  75          /*写显示数据到LCD                                                  */
  76          /*RS=H，RW=L，E=高脉冲，D0-D7=数据。                               */
  77          /*                                                                 */
  78          /*******************************************************************/
  79          void lcd_wdat(uchar dat)
  80          {                          
  81   1         while(lcd_busy());
  82   1          LCD_RS = 1;
  83   1          LCD_RW = 0;
  84   1          LCD_EN = 0;
  85   1          P0 = dat;
  86   1          delayNOP();
  87   1          LCD_EN = 1;
  88   1          delayNOP();
  89   1          LCD_EN = 0; 
  90   1      }
  91          /*******************************************************************/
  92          /*                                                                 */
  93          /*  LCD初始化设定                                                  */
  94          /*                                                                 */
  95          /*******************************************************************/
  96          void lcd_init()
  97          { 
  98   1          LCD_PSB = 1;         //并口方式
  99   1          
 100   1      //  LCD_RST = 0;     //液晶复位
 101   1      //    delay(3);                   
 102   1      //   LCD_RST = 1;      
 103   1      //    delay(3);
 104   1          
 105   1          lcd_wcmd(0x34);      //扩充指令操作
 106   1          delay_12864(5);
 107   1          lcd_wcmd(0x30);      //基本指令操作
 108   1        delay_12864(5);
 109   1          lcd_wcmd(0x0c);      //显示开，关光标
 110   1          delay_12864(5);
 111   1          lcd_wcmd(0x01);      //清除LCD的显示内容
 112   1          delay_12864(5);
 113   1      }
 114          /*********************************************************/
 115          /*                                                       */
 116          /* 设定显示位置                                          */
 117          /*                                                       */
C51 COMPILER V9.52.0.0   12864                                                             05/29/2015 18:43:27 PAGE 3   

 118          /*********************************************************/
 119          void lcd_pos(uchar X,uchar Y)
 120          {                          
 121   1         uchar  pos;
 122   1         if (X==1)
 123   1           {X=0x80;}
 124   1         else if (X==2)
 125   1           {X=0x90;}
 126   1         else if (X==3)
 127   1           {X=0x88;}
 128   1         else if (X==4)
 129   1           {X=0x98;}
 130   1         pos = X+Y ; 
 131   1       
 132   1         lcd_wcmd(pos);     //显示地址
 133   1      }
 134          /*********************************************************
 135          *                                                        *
 136          * 闪烁函数                                               *
 137          *                                                        *
 138          *********************************************************/
 139          void lcdflag() 
 140          {
 141   1         lcd_wcmd(0x08);   
 142   1         delay_12864(400);
 143   1         lcd_wcmd(0x0c);   
 144   1         delay_12864(400);
 145   1         lcd_wcmd(0x08);   
 146   1         delay_12864(400);
 147   1         lcd_wcmd(0x0c);   
 148   1        delay_12864(400);
 149   1         lcd_wcmd(0x08);   
 150   1         delay_12864(400);
 151   1         lcd_wcmd(0x0c);   
 152   1         delay_12864(5);
 153   1         lcd_wcmd(0x01);   
 154   1         delay_12864(5);
 155   1      }
 156          /*********************************************************
 157          *                                                        *
 158          * 图形显示                                               *
 159          *                                                        *
 160          *********************************************************/
 161          void photodisplay(uchar *bmp) 
 162          { 
 163   1        uchar i,j;
 164   1      
 165   1        lcd_wcmd(0x34);        //写数据时,关闭图形显示
 166   1      
 167   1        for(i=0;i<32;i++)
 168   1        {
 169   2          lcd_wcmd(0x80+i);    //先写入水平坐标值
 170   2          lcd_wcmd(0x80);      //写入垂直坐标值
 171   2          for(j=0;j<16;j++)   //再写入两个8位元的数据    
 172   2          lcd_wdat(*bmp++);     
 173   2          delay1_12864(1);
 174   2        }
 175   1      
 176   1        for(i=0;i<32;i++)
 177   1        { 
 178   2          lcd_wcmd(0x80+i);
 179   2          lcd_wcmd(0x88);
C51 COMPILER V9.52.0.0   12864                                                             05/29/2015 18:43:27 PAGE 4   

 180   2          for(j=0;j<16;j++)         
 181   2        lcd_wdat(*bmp++);    
 182   2        delay1_12864(1);
 183   2        }
 184   1        lcd_wcmd(0x36);       //写完数据,开图形显示 
 185   1      }
 186          /*********************************************************
 187          *                                                        *
 188          * 清屏函数                                               *
 189          *                                                        *
 190          *********************************************************/
 191          void  clr_screen()
 192          {
 193   1         lcd_wcmd(0x34);      //扩充指令操作
 194   1         delay_12864(5);    
 195   1         lcd_wcmd(0x30);      //基本指令操作
 196   1         delay_12864(5); 
 197   1         lcd_wcmd(0x01);      //清屏 
 198   1         delay_12864(5);     
 199   1      }
 200          /**********************************************************
 201          ; 显示字符表代码
 202          **********************************************************/
 203          void  bytecode()
 204          {
 205   1         uchar  s;
 206   1         clr_screen();          //清屏    
 207   1         lcd_wcmd(0x80);        //设置显示位置为第一行  
 208   1         for(s=0;s<16;s++)
 209   1         {
 210   2           lcd_wdat(0x30+s); 
 211   2         }
 212   1         lcd_wcmd(0x90);        //设置显示位置为第二行 
 213   1         for(s=0;s<16;s++)
 214   1         {
 215   2           lcd_wdat(0x40+s); 
 216   2         }
 217   1         lcd_wcmd(0x88);        //设置显示位置为第三行  
 218   1         for(s=0;s<16;s++)
 219   1         {
 220   2           lcd_wdat(0x50+s); 
 221   2         }
 222   1         lcd_wcmd(0x98);       //设置显示位置为第四行   
 223   1         for(s=0;s<16;s++)
 224   1         {
 225   2           lcd_wdat(0x60+s); 
 226   2         }
 227   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    537    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
